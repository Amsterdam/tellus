# Generated by Django 2.1.1 on 2018-12-19 07:41

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ('tellus_data', '0002_materialized_view_tellingen'),
    ]

    operations = [
        migrations.RunSQL("""
DROP MATERIALIZED VIEW IF EXISTS "tellus_data_cars_per_hour_length";
CREATE MATERIALIZED VIEW tellus_data_cars_per_hour_length
  AS
    SELECT
           ROW_NUMBER() OVER (ORDER BY 1) as id,
           tellus.id as tellus_id,
           telling.lengte_interval_id,
           lengte.label as lengte_label, 
           richting.richting as richting_id,
           telling.tijd_van as dag_uur,
           (CASE
              WHEN
               DATE_PART('day', telling.tijd_van) NOT IN (0,6)
                      THEN 'Werkdag'
              WHEN
               DATE_PART('day', telling.tijd_van) IN (0,6)
                      THEN
               'Weekend'
               END) AS dag_type,
           SUM(telling.aantal) AS aantal
    FROM tellus_data_telling telling
           LEFT join tellus_data_telrichting richting
             ON telling.tel_richting_id= richting.id
           LEFT JOIN tellus_data_tellus tellus
             ON richting.tellus_id = tellus.id
           LEFT JOIN tellus_data_lengteinterval lengte
             ON telling.lengte_interval_id = lengte.id

    GROUP BY tellus.id,
             richting.richting,
             telling.lengte_interval_id,
             lengte.label,
             tijd_van
    ORDER BY tellus.id,
             richting.richting,
             tijd_van
WITH DATA;
CREATE UNIQUE INDEX tellus_data_cars_per_hour_length_pkey ON tellus_data_cars_per_hour_length(id);
        """, """
DROP MATERIALIZED VIEW IF EXISTS "tellus_data_cars_per_hour_length";
        """),
    ]
