# -*- coding: utf-8 -*-
# Generated by Eelke on 2018-09-03 15:55
from __future__ import unicode_literals

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ("tellus_data", "0017_table_tellus_expanded"),
    ]

    operations = [
        migrations.RunSQL("""
            DROP TABLE IF EXISTS public.tellus_data_cars_per_hour_per_day;
            CREATE TABLE public.tellus_data_cars_per_hour_per_day(
                id SERIAL PRIMARY KEY,
                id_tellus INT,
                dag_uur_gemeten TIMESTAMP,
                dag_type TEXT,
                aantal INT);
             INSERT INTO public.tellus_data_cars_per_hour_per_day (
                id_tellus,
                dag_uur_gemeten,
                dag_type,
                aantal)
                 (SELECT
                   id_tellus,
                   tijd_van,
                (CASE 
                  WHEN
                    DATE_PART('day', tijd_van) > 0 AND 
                    DATE_PART('day', tijd_van) < 6
                  THEN 'Werkdag'
                  WHEN
                    DATE_PART('day', tijd_van) IN (0,7)
                  THEN
                    'Weekend'
                END) AS dag_type,
                   ROUND(sum(meetwaarde), 0)::INT as sum_meetwaarde
                 FROM tellus_data_expanded
                 WHERE representatief = 1 AND validatie = 1 --AND tellus_id = 2
            GROUP BY
              id_tellus,
              tijd_van
            ORDER BY
              id_tellus,
              tijd_van);

            ALTER TABLE public.tellus_data_cars_per_hour_per_day
              OWNER TO tellus;
        """),
    ]
