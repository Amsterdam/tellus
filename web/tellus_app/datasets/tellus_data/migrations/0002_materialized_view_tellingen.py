# Generated by Django 2.1.1 on 2018-12-19 07:35

from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ('tellus_data', '0001_initial'),
    ]

    operations = [
        migrations.RunSQL("""
DROP MATERIALIZED VIEW IF EXISTS "tellus_data_cars_per_hour";
CREATE MATERIALIZED VIEW tellus_data_cars_per_hour
  AS
    SELECT
           ROW_NUMBER() OVER (ORDER BY 1) as id,
           tellus.id as tellus_id,
           richting.richting as richting_id,
           telling.tijd_van as dag_uur,
           (CASE
              WHEN
               DATE_PART('day', telling.tijd_van) NOT IN (0,6)
                      THEN 'Werkdag'
              WHEN
               DATE_PART('day', telling.tijd_van) IN (0,6)
                      THEN
               'Weekend'
               END) AS dag_type,
           SUM(telling.aantal) AS aantal
    FROM tellus_data_telling telling
           LEFT join tellus_data_telrichting richting
             ON telling.tel_richting_id= richting.id
           LEFT JOIN tellus_data_tellus tellus
             ON richting.tellus_id = tellus.id

    GROUP BY tellus.id,
             richting.richting,
             tijd_van
    ORDER BY tellus.id,
             richting.richting,
             tijd_van
WITH DATA
        """, """
DROP MATERIALIZED VIEW IF EXISTS "tellus_data_cars_per_hour";
        """),
    ]
